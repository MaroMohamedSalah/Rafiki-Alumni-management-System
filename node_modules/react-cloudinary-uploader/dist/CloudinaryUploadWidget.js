import React, { useEffect, useRef } from "react";
const CloudinaryUploadWidget = ({ cloudName, uploadPreset, options = {}, onUploadSuccess, onUploadFailure, buttonText, buttonStyle, buttonClass, }) => {
    const cloudinaryWidget = useRef(null);
    const widgetRef = useRef(null);
    useEffect(() => {
        const script = document.createElement("script");
        script.src = "https://upload-widget.cloudinary.com/global/all.js";
        script.async = true;
        script.type = "text/javascript";
        script.onload = () => {
            cloudinaryWidget.current = window.cloudinary;
            widgetRef.current = cloudinaryWidget.current.createUploadWidget(Object.assign({ cloudName,
                uploadPreset }, options), (error, result) => {
                if (!error && result && result.event === "success") {
                    if (onUploadSuccess) {
                        onUploadSuccess(result.info);
                    }
                    else {
                        console.log(result.info);
                    }
                    if (error) {
                        if (onUploadFailure) {
                            onUploadFailure(error);
                        }
                        else {
                            console.log(error);
                        }
                    }
                }
            });
        };
        document.body.appendChild(script);
        return () => {
            document.body.removeChild(script);
        };
    }, [cloudName, uploadPreset, options, onUploadSuccess]);
    return (React.createElement("button", { onClick: () => widgetRef.current.open(), style: Object.assign({ border: "none" }, buttonStyle), className: buttonClass }, buttonText || "Upload Image"));
};
export default CloudinaryUploadWidget;
